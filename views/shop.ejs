<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results | StudentStore</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    
    <link rel="stylesheet" href="./styles/search.css">
    <%- include('./partials/navbar') %>
    <main>
        <div class="container">
                <div class="breadcrumb">
                    <a href="/">Home </a> &gt; <%= category %>
                </div>
   
        
 
            <section class="search-results-section">
                <div class="search-results-header">
                <!-- Updates when search box has entry-->
                <% if (false) { %>
                    <h1>Search Results</h1>
                    <p>Found 24 results</p>
                    
                <% } %>
                </div>

                <div class="search-filter-container">
                    <div class="search-filters">
                        <div class="filter-group">
                            <h3>Category</h3>
                            <ul>
                                <% subcategories.subcategories.forEach(sub => { %>
                                    <li>
                                        <input type="checkbox" id="<%= sub %>">
                                        <label for="<%= sub %>"><%= sub %></label>
                                    </li>
                                <% }) %>
                            </ul>
                        </div>
                        <div class="filter-group">
                            <h3>Price Range</h3>
                            <ul>
                                <% prices.forEach(price => { %>
                                    <li>
                                        <input type="checkbox" id="<%= price.range %>">
                                        <label for="<%= price.range %>"><%= price.range %></label>
                                    </li>
                            <% }) %>
                            </ul>
                        </div>

                    </div>

                    <div class="search-results-content">
                        <div class="search-results-sorting">
                            <label for="sort-by">Sort by:</label>
                            <select id="sort-by">
                                <option value="relevance" selected>Relevance</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="newest">Newest</option>
                                <option value="bestselling">Best Selling</option>
                            </select>
                            <div class="view-options">
                                <button class="view-grid active"><i class="fas fa-th"></i></button>
                                <button class="view-list"><i class="fas fa-list"></i></button>
                            </div>
                        </div>

                        <div class="search-results-grid">
                            <!-- Product Card 1 -->
                            <% products.forEach(product => { %> 
                                <div class="product-card">
                                    <div class="product-badge bestseller">Bestseller</div>
                                    <div class="product-image">
                                        <a href="product-detail.html?id=123">
                                            <img src="/api/placeholder/200/250" alt=<%= product.name %>>
                                        </a>
                                        <button class="quick-view-btn">Quick View</button>
                                    </div>
                                    <div class="product-info">
                                        <h3><a href="product-detail.html?id=123"><%= product.name %></a></h3>
                                        <div class="product-rating">
                                        <% for(var i= 1; i <= product.number_stars; i++) { %> 
                                            <i class="fas fa-star"></i>
                                        <% }; %>

                                            <!--i class="fas fa-star-half-alt"></i-->
                                        </div>
                                        <div class="product-price">
                                            <span class="current-price"><%= product.price %></span>
                                        </div>
                                        <div class="product-actions">
                                            <button class="add-to-cart-btn">Add to Cart</button>
                                            <button class="add-to-wishlist-btn"><i class="far fa-heart"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>


                        </div>

                        <div class="pagination">
                            <a href="#" onclick="changePage(event, <%= page-1 %>)" > < </a>
                            <% for(var i= 1; i <= numberOfPages; i++) { %> 
                                <a href="#"  onclick="changePage(event, <%= i %>)" class="<%= i === page ? 'active' : '' %>"><%= i %> </a>

                            <% }; %>
                            <a href="#" onclick="changePage(event, <%= page+1 %>)" > > </a>
                        </div>
                    </div>
                </div>
            </section>
            <% if (false) { %>
            <section class="related-searches">
                <h2>Related Searches</h2>
                <div class="related-search-tags">
                    <a href="search-results.html?query=programming+textbooks">Programming Textbooks</a>
                    <a href="search-results.html?query=computer+science+degree">Computer Science Degree</a>
                    <a href="search-results.html?query=coding+bootcamp">Coding Bootcamp</a>
                    <a href="search-results.html?query=python+books">Python Books</a>
                    <a href="search-results.html?query=algorithms">Algorithms</a>
                </div>
            </section>
            <%} %>
        </div>
    </main>
    <script>
        function changePage(event, page) {
            event.preventDefault(); // Prevent default link behavior
    
            // Get the current URL parameters
            const params = new URLSearchParams(window.location.search);
            let currentPage = parseInt(params.get("page")) || 1;
    
            // Determine the new page number
            if (page === 'next') {
                currentPage += 1;
            } else if (page === 'prev' && currentPage > 1) {
                currentPage -= 1;
            } else {
                currentPage = page;
            }
    
            // Update the URL parameter for the page
            params.set("page", currentPage);
            const newUrl = window.location.pathname + "?" + params.toString();
    
            // Push new state to URL without reloading the page
            window.history.pushState({}, "", newUrl);
    
            // Call a function to reload the products dynamically
            fetchProducts(newUrl);

            event.preventDefault(); // Prevent default link behavior

            // Update URL with new page number
            const url = new URL(window.location.href);
            url.searchParams.set("page", page); // Set or update the "page" query parameter

            // Reload the page with the updated URL
            window.location.href = url.toString();
        }
    
        function fetchProducts(url) {
            // Example: Fetch new products based on the updated URL (AJAX request)
            console.log("Fetching products for URL:", url);
            
            // You can replace this with an actual fetch() request to your backend
        }
    </script>
    

</body>
</html>